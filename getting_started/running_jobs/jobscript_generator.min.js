"use strict";function _cscs_clean_fields(){document.getElementById("selectPartition").innerHTML=null,document.getElementById("jobscript").innerHTML=null}function cscs_populate_form(){__cscs_partition=new DaintGPUPartition("normal"),__cscs_partition.updatePartitionsInGUI(),cscs_print_jobscript(),$("#selectMachine").change(function(){"Daint Hybrid"==$(this).val()?(_cscs_clean_fields(),__cscs_partition=new DaintGPUPartition("normal"),__cscs_partition.updatePartitionsInGUI(),cscs_print_jobscript()):"Daint MultiCore"==$(this).val()?(_cscs_clean_fields(),__cscs_partition=new DaintMCPartition("normal"),__cscs_partition.updatePartitionsInGUI(),cscs_print_jobscript()):"Monch"==$(this).val()?(_cscs_clean_fields(),__cscs_partition=new MonchPartition("normal"),__cscs_partition.updatePartitionsInGUI(),cscs_print_jobscript()):"Leone"==$(this).val()?(_cscs_clean_fields(),__cscs_partition=new LeonePartition("normal"),__cscs_partition.updatePartitionsInGUI(),cscs_print_jobscript()):"Tave"==$(this).val()&&(_cscs_clean_fields(),__cscs_partition=new TavePartition("normal"),__cscs_partition.updatePartitionsInGUI(),cscs_print_jobscript())}),$("#submit_button").click(function(){cscs_print_jobscript()})}function cscs_print_jobscript(){return document.getElementById("jobscript").innerHTML=null,$("#jobscriptalert").hide(),__cscs_partition.print(document.getElementById("jobscript"),document.getElementById("partitionwebsite"),document.getElementById("jobscriptalert")),!0}function cscs_validate_hour(){var t=$("#hours").val(),e=$("#minutes").val(),i=_cscs_compute_time(t,e),r=__cscs_partition.getValue(__cscs_partition.max_wall_time),n=_cscs_compute_time_from_string(r);if(null!=r&&Number(i)>Number(n)){var s=_cscs_split_time(r);i=_cscs_compute_time(s.hours,e),Number(i)>Number(n)?($("#hours").val("max",_cscs_unpad_interger(s.hours)),$("#hours").val(_cscs_unpad_interger(s.hours-1))):($("#hours").val("max",_cscs_unpad_interger(s.hours)),$("#hours").val(_cscs_unpad_interger(s.hours)))}return!0}function cscs_validate_minutes(){var t=$("#hours").val(),e=$("#minutes").val(),i=_cscs_compute_time(t,e),r=__cscs_partition.getValue(__cscs_partition.max_wall_time),n=_cscs_compute_time_from_string(r);if(null!=r&&Number(i)>Number(n)){var s=_cscs_split_time(r);$("#minutes").val("max",_cscs_unpad_interger(s.minutes)),$("#minutes").val(_cscs_unpad_interger(s.minutes))}return!0}function cscs_validate_num_tasks_per_core(){var t=$("#numberTasksPerCore"),e=t.val(),i=__cscs_partition.hasHyperThreading();if(0==i)t.val("max",1),t.val(1),__cscs_partition.setNumTasksPerNodeAndNumCpusPerNodeValues(1);else{var r=__cscs_partition.getValue(__cscs_partition.max_num_tasks_per_core);Number(e)>Number(r)&&(t.val("max",r),t.val(r),__cscs_partition.setNumTasksPerNodeAndNumCpusPerNodeValues(r))}return!0}function cscs_validate_num_tasks_per_node(){var t=$("#numberOfTasksPerNode"),e=_cscs_get_GUI_PropertyValue("#numberOfTasksPerNode"),i=__cscs_partition.getMaxNumberOfThreads(),r=_cscs_get_GUI_PropertyValue("#numberOfCpusPerTask");null==r&&(r=1);var n=Math.floor(Number(i)/Number(r));return Number(e)>Number(n)&&(t.val("max",n),t.val(n)),!0}function cscs_validate_num_cpus_per_task(){var t=$("#numberOfCpusPerTask"),e=_cscs_get_GUI_PropertyValue("#numberOfCpusPerTask"),i=__cscs_partition.getMaxNumberOfThreads(),r=_cscs_get_GUI_PropertyValue("#numberOfTasksPerNode");null==r&&(r=1);var n=Math.floor(Number(i)/Number(r));return Number(e)>Number(n)&&(t.val("max",n),t.val(n)),!0}var _cscs_split_time=function(t){var e=0,i=0,r=0,n=t.split(":");return 3!=n.length?null:(e=n[0],i=n[1],r=n[2],{hours:e,minutes:i,seconds:r})},_cscs_compute_time_from_string=function(t){var e=_cscs_split_time(t);return null!=e?Number(60*e.hours)+Number(e.minutes):null},_cscs_compute_time=function(t,e){return Number(60*t)+Number(e)},_cscs_compose_time=function(t,e){return(null==t||"undefined"==t||""==t)&&(t=0),(null==e||"undefined"==e||""==e)&&(e=0),_cscs_pad_interger(t)+":"+_cscs_pad_interger(e)+":00"},_cscs_pad_interger=function(t){return Number(t)<10&&"00"!=t&&"00"!=t&&"01"!=t&&"02"!=t&&"03"!=t&&"04"!=t&&"05"!=t&&"06"!=t&&"07"!=t&&"08"!=t&&"09"!=t?"0"+t:t},_cscs_unpad_interger=function(t){return Number(t)<10&&("00"==t||"00"==t||"01"==t||"02"==t||"03"==t||"04"==t||"05"==t||"06"==t||"07"==t||"08"==t||"09"==t)?t[1]:t},_cscs_convert_time_string=function(t){var e=_cscs_split_time(t);return null!=e?_cscs_pad_interger(e.hours)+":"+_cscs_pad_interger(e.minutes)+":00":null},_cscs_is_element_hidden=function(t){return $(t).is(":visible")},_cscs_get_GUI_PropertyValue=function(t){var e=$(t),i=e.val(),r=_cscs_is_element_hidden(e);return 0==r?null:i},_bindPrototypeMethods=function(t,e){t.prototype=Object.create(e.prototype)},Partition=function(){this.name="partition",this.typeName=Partition,this.Partition={normal:"--partition="},this.list_of_partitions=["normal"],this.directive="#SBATCH ",this.NumNodesDirective="--nodes=",this.NumGpusPerNodesDirective="--ntasks-per-node=",this.NumTasksPerNodesDirective="--ntasks-per-node=",this.NumCpusPerTaskDirective="--cpus-per-task=",this.NumTasksPerCoreDirective="--ntask-per-core=",this.MemoryDirective="--mem=",this.EMailDirective="--mail-user=",this.NameDirective="--job-name=",this.ExclusiveDirective="--exclusive",this.WallTimeDirective="--time=",this.allow_node_sharing={},this.allow_hyperthreading={},this.partition_website={},this.pre_commands={},this.default_executable={},this.has_constraints={},this.max_num_nodes={normal:1},this.max_num_gpus={normal:1},this.max_num_tasks_per_node={normal:1},this.max_num_cpus_per_tasks={normal:1},this.max_num_tasks_per_core={normal:1},this.max_memory_per_node={normal:120},this.max_wall_time={normal:"00:00:00"},this.target_time=0};Partition.prototype.getValue=function(t){var e=t[this.name];return"undefined"==e||null==e||""==e?null:e},Partition.prototype.hasHyperThreading=function(){var t=this.getValue(this.max_num_tasks_per_core),e=_cscs_get_GUI_PropertyValue("#numberTasksPerCore");return null==e&&(e=1),t=null!=t&&Number(t)>Number(1)&&Number(e)>Number(1)?!0:!1},Partition.prototype.getMaxNumberOfThreads=function(){var t=this.hasHyperThreading(),e=this.getValue(this.max_num_tasks_per_node),i=this.getValue(this.max_num_tasks_per_core);return null==e?e=1:1==t&&(e*=i),e},Partition.prototype.setNumTasksPerNodeAndNumCpusPerNodeValues=function(t){var e=this.getValue(this.max_num_tasks_per_node);null!=e?this.hasHyperThreading()&&(e*=t):e=1,$("#numberOfTasksPerNode").val("max",e),$("#numberOfTasksPerNode").val(e);var i=this.getValue(this.max_num_cpus_per_tasks);i=null!=i?Math.floor(this.getMaxNumberOfThreads()/e):1,$("#numberOfCpusPerTask").val("max",i),$("#numberOfCpusPerTask").val(i)},Partition.prototype.updateNodesInformation=function(){var t=this.getValue(this.max_num_tasks_per_core);null!=t?this.hasHyperThreading()||(t=1):t=1,$("#numberTasksPerCore").val("max",t),$("#numberTasksPerCore").val(t),this.setNumTasksPerNodeAndNumCpusPerNodeValues(t)},Partition.prototype.updateTimeGUI=function(){var t=this.getValue(this.max_wall_time);if(null==t)$("#hours").val("0"),$("#minutes").val("0");else{var e=_cscs_split_time(t);$("#hours").val(_cscs_unpad_interger(e.hours)),$("#minutes").val(_cscs_unpad_interger(e.minutes))}},Partition.prototype.hideGUIDataField=function(t,e){var i=this.getValue(e);null!=i?$(t).show():$(t).hide()},Partition.prototype.hideGUIBooleanField=function(t,e,i){var r=this.getValue(e);null!=r&&r==i?$(t).show():$(t).hide()},Partition.prototype.updatePartitionsFields=function(){this.hideGUIBooleanField("#ExclusiveNodeGroup",this.allow_node_sharing,!0),this.hideGUIDataField("#numberOfNodesGroup",this.max_num_nodes),this.hideGUIDataField("#numberTasksPerCoreGroup",this.max_num_tasks_per_core),this.hideGUIDataField("#numberOfTasksPerNodeGroup",this.max_num_tasks_per_node),this.hideGUIDataField("#numberOfCpusPerTaskGroup",this.max_num_cpus_per_tasks),this.hideGUIDataField("#bigMemoryGroup",this.max_memory_per_node);var t=this.getValue(this.default_executable);null==t?$("#executableGroup").show():($("#executableGroup").hide(),$("#executable").val(""))},Partition.prototype.updatePartitionsInGUI=function(){for(var t=this,e=0;e<t.list_of_partitions.length;e++)$("#selectPartition").append("<option>"+this.list_of_partitions[e]+"</option>");$("#selectPartition").change(function(){__cscs_partition=new t.typeName($(this).val()),__cscs_partition.updatePartitionsFields(),__cscs_partition.updateTimeGUI(),__cscs_partition.updateNodesInformation(),cscs_print_jobscript()}),$("#numberTasksPerCore").change(function(){__cscs_partition.updateNodesInformation(),cscs_print_jobscript()}),__cscs_partition.updatePartitionsFields(),__cscs_partition.updateTimeGUI(),__cscs_partition.updateNodesInformation()},Partition.prototype.printPartition=function(){var t=this.getValue(this.Partition);return null==t?"":this.directive+t+this.name+"\n"},Partition.prototype.printConstraints=function(){var t=this.getValue(this.has_constraints);return null==t?"":this.directive+t+"\n"},Partition.prototype.printExclusive=function(){var t=$("#ExclusiveNode").prop("checked"),e=this.getValue(this.allow_node_sharing);return null!=e&&1==t?this.directive+this.ExclusiveDirective+"\n":""},Partition.prototype.printNumNodes=function(){var t=_cscs_get_GUI_PropertyValue("#numberOfNodes");return null!=t?this.directive+this.NumNodesDirective+t+"\n":""},Partition.prototype.printNumTasksPerCore=function(){var t=_cscs_get_GUI_PropertyValue("#numberTasksPerCore");return null!=t?this.directive+this.NumTasksPerCoreDirective+t+"\n":""},Partition.prototype.printNumTasksPerNodes=function(){var t=_cscs_get_GUI_PropertyValue("#numberOfTasksPerNode");return null!=t?this.directive+this.NumTasksPerNodesDirective+t+"\n":""},Partition.prototype.printNumCpusPerTask=function(){var t=_cscs_get_GUI_PropertyValue("#numberOfCpusPerTask");return null!=t?this.directive+this.NumCpusPerTaskDirective+t+"\n":""},Partition.prototype.printEnvironmentVariables=function(){var t="";return t+="export OMP_NUM_THREADS=$SLURM_CPUS_PER_TASK\n"},Partition.prototype.getWallTime=function(){var t=$("#hours").val(),e=$("#minutes").val(),i=_cscs_compute_time(t,e),r=_cscs_compose_time(t,e),n=this.getValue(this.max_wall_time),s=_cscs_convert_time_string(n),a=_cscs_compute_time_from_string(n);if(null!=n&&Number(i)>Number(a))i=a,r=s;else if(null==n)return"";return this.directive+this.WallTimeDirective+r+"\n"},Partition.prototype.printMemPerNode=function(){var t=$("#bigMemory").prop("checked"),e=this.getValue(this.max_memory_per_node);if(null!=e&&1==t)t=e;else if(null==e||0==t)return"";return this.directive+this.MemoryDirective+t+"GB\n"},Partition.prototype.printExecutable=function(){var t=$("#executable").val(),e=this.getValue(this.default_executable);return null==e||""!=t&&"undefined"!=t&&null!=t?(""==t||"undefined"==t||null==t)&&(t="./executable.x"):t=e,"srun "+t},Partition.prototype.printPreCommand=function(){var t=this.getValue(this.pre_commands);return null!=t&&""!=t&&"undefined"!=t?t+"\n":""},Partition.prototype.printPartitionWebSite=function(t){var e=this.getValue(this.partition_website);null!=e&&(t.innerHTML="For more information about this queue, please refer to this <a target='_blank' href='"+e+"'>website</a>.")},Partition.prototype.printJobScriptMessage=function(t){var e=this.getMaxNumberOfThreads(),i=1,r=[],n=_cscs_get_GUI_PropertyValue("#numberTasksPerCore"),s=_cscs_get_GUI_PropertyValue("#numberOfTasksPerNode"),a=_cscs_get_GUI_PropertyValue("#numberOfCpusPerTask");this.hasHyperThreading();null!=n&&r.push("tasks per core"),null!=s&&(i*=s,r.push("tasks per node")),null!=a&&(i*=a,r.push("cpus per task"));var o=!1;if(Number(i)<Number(e)&&(o=!0),t.innerHTML=null,o){var _=$("#jobscriptalert");_.show(),1==_.hasClass("alert-success")&&_.removeClass("alert-success"),_.addClass("alert-warning"),t.innerHTML+="<h4>Warning</h4>",t.innerHTML+="You have selected a ",Number(r.length)>1?t.innerHTML+="combination of ":t.innerHTML+="number for ";var u,c=0,l=r.length;for(u in r)c=Number(c)+1,t.innerHTML+="<b>"+r[u]+"</b>",c==l-1?t.innerHTML+=" and ":c!=l&&(t.innerHTML+=", ");t.innerHTML+=" that cannot achieve the maximum potential of the node.",t.innerHTML+=" <p>The maximum parallel processes is <b>"+e+"</b> but you have selected only <b>"+i+"</b>.</p>"}else if(1!=i){var _=$("#jobscriptalert");_.show(),1==_.hasClass("alert-warning")&&_.removeClass("alert-warning"),_.addClass("alert-success"),t.innerHTML+="<h4>Success</h4>",t.innerHTML+="<p>For a hybrid MPI + OpenMP program you have selected: </p>",t.innerHTML+="<p><b>"+s+"</b> MPI ranks and <b>"+a+"</b> OpenMP threads </p>"}else{var _=$("#jobscriptalert");_.hide()}},Partition.prototype.printJobScript=function(t){t.innerHTML="#!/bin/bash -l\n";var e=$("#jobName").val(),i=$("#jobName").prop("placeholder");"undefined"!=e&&null!=e&&""!=e?t.innerHTML+=this.directive+this.NameDirective+e+"\n":"undefined"!=i&&null!=i&&""!=i&&(t.innerHTML+=this.directive+this.NameDirective+i+"\n");var r=$("#emailAddress").val();"undefined"!=r&&null!=r&&""!=r&&(t.innerHTML+=this.directive+this.EMailDirective+r+"\n"),t.innerHTML+=this.getWallTime(),t.innerHTML+=this.printNumNodes(),t.innerHTML+=this.printNumTasksPerCore(),t.innerHTML+=this.printNumTasksPerNodes(),t.innerHTML+=this.printNumCpusPerTask(),t.innerHTML+=this.printMemPerNode(),t.innerHTML+=this.printPartition(),t.innerHTML+=this.printConstraints(),t.innerHTML+=this.printExclusive(),t.innerHTML+="\n",t.innerHTML+=this.printEnvironmentVariables(),t.innerHTML+="\n",t.innerHTML+=this.printPreCommand(),t.innerHTML+=this.printExecutable()},Partition.prototype.print=function(t,e,i){this.printPartitionWebSite(e),this.printJobScriptMessage(i),this.printJobScript(t)};var DaintGPUPartition=function(t){Partition.call(this),this.name=t,this.typeName=DaintGPUPartition,this.Partition={normal:"--partition=",low:"--partition=",high:"--partition=",xfer:"--partition=",prepost:"--partition=",debug:"--partition="},this.max_wall_time={normal:"24:00:00",low:"06:00:00",high:"24:00:00",xfer:"24:00:00",prepost:"00:30:00",debug:"00:30:00"},this.partition_website={normal:"http://eth-cscs.github.io/getting_started/running_jobs/piz_daint",low:"http://eth-cscs.github.io/getting_started/running_jobs/piz_daint",high:"http://eth-cscs.github.io/getting_started/running_jobs/piz_daint",xfer:"http://user.cscs.ch/storage/data_transfer/internal_transfer/index.html",prepost:"MISSING WEBSITE",debug:"MISSING WEBSITE"},this.list_of_partitions=["normal","low","high","xfer","prepost","debug"],this.allow_node_sharing={normal:!1},this.pre_commands={xfer:"module unload xalt"},this.default_executable={xfer:"rsync -av $1 $2\nif [ -n '$3' ]; then\n    sbatch --dependency=afterok:$SLURM_JOB_ID $3\nfi\n"},this.has_constraints={normal:"--constraint=gpu",low:"--constraint=gpu",high:"--constraint=gpu",debug:"--constraint=gpu"},this.max_num_nodes={normal:2400,low:2400,high:2400,debug:4},this.max_num_gpus={normal:1,low:1,high:1,debug:1},this.max_num_tasks_per_node={normal:12,low:12,high:12,debug:12},this.max_num_cpus_per_tasks={normal:12,low:12,high:12,debug:12},this.max_num_tasks_per_core={normal:2,low:2,high:2,debug:2},this.max_memory_per_node={normal:120}};_bindPrototypeMethods(DaintGPUPartition,Partition);var DaintMCPartition=function(t){DaintGPUPartition.call(this),this.name=t,this.typeName=DaintMCPartition,this.has_constraints={normal:"--constraint=mc",low:"--constraint=mc",high:"--constraint=mc",debug:"--constraint=mc"},this.max_num_tasks_per_node={normal:36,low:36,high:36,debug:36},this.max_num_cpus_per_tasks={normal:36,low:36,high:36,debug:36}};_bindPrototypeMethods(DaintMCPartition,DaintGPUPartition);var MonchPartition=function(t){Partition.call(this),this.name=t,this.typeName=MonchPartition,this.Partition={normal:"--partition=",largemem:"--partition="},this.list_of_partitions=["normal","largemem"]};_bindPrototypeMethods(MonchPartition,Partition);var LeonePartition=function(t){Partition.call(this),this.name=t,this.typeName=LeonePartition,this.Partition={normal:"--partition=",largemem:"--partition="},this.list_of_partitions=["normal","debug","longrun"]};_bindPrototypeMethods(LeonePartition,Partition);var TavePartition=function(t){Partition.call(this),this.name=t,this.typeName=TavePartition,this.Partition={normal:"--partition=",largemem:"--partition="},this.list_of_partitions=["normal","largemem"],this.max_num_tasks_per_core={normal:4,largemem:4}};_bindPrototypeMethods(TavePartition,Partition);var __cscs_partition={};